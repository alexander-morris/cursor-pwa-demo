{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { getFirestore, collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { getApp } from 'firebase/app';\nexport var generateReferralCode = function () {\n  var _ref = _asyncToGenerator(function* (userId) {\n    try {\n      console.log('Generating referral code for user:', userId);\n      var app = getApp();\n      var db = getFirestore(app);\n      var code = generateUniqueCode();\n      console.log('Generated unique code:', code);\n      try {\n        var testRef = collection(db, 'referralCodes');\n        if (!testRef) {\n          throw new Error('Firestore not initialized');\n        }\n        var docData = {\n          code: code,\n          createdBy: userId,\n          createdAt: serverTimestamp(),\n          expiresAt: new Date(Date.now() + 48 * 60 * 60 * 1000),\n          used: false,\n          usedBy: null\n        };\n        console.log('Attempting to save referral code:', docData);\n        yield addDoc(collection(db, 'referralCodes'), docData);\n        console.log('Successfully saved referral code to Firestore');\n      } catch (error) {\n        console.error('Firestore error:', error);\n        console.log('Returning generated code despite Firestore error');\n        return code;\n      }\n      return code;\n    } catch (error) {\n      console.error('Error generating referral code:', error);\n      var tempCode = generateUniqueCode();\n      console.log('Returning temporary code due to error:', tempCode);\n      return tempCode;\n    }\n  });\n  return function generateReferralCode(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport function generateUniqueCode() {\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  var segments = 3;\n  var segmentLength = 4;\n  var code = '';\n  for (var i = 0; i < segments; i++) {\n    for (var j = 0; j < segmentLength; j++) {\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    if (i < segments - 1) code += '-';\n  }\n  return code;\n}","map":{"version":3,"names":["getFirestore","collection","addDoc","serverTimestamp","getApp","generateReferralCode","_ref","_asyncToGenerator","userId","console","log","app","db","code","generateUniqueCode","testRef","Error","docData","createdBy","createdAt","expiresAt","Date","now","used","usedBy","error","tempCode","_x","apply","arguments","chars","segments","segmentLength","i","j","charAt","Math","floor","random","length"],"sources":["/Users/almorris/cursor-test/frontend/src/utils/referralUtils.js"],"sourcesContent":["import { getFirestore, collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { getApp } from 'firebase/app';\n\nexport const generateReferralCode = async (userId) => {\n  try {\n    console.log('Generating referral code for user:', userId);\n    const app = getApp();\n    const db = getFirestore(app);\n    \n    // Generate a unique code\n    const code = generateUniqueCode();\n    console.log('Generated unique code:', code);\n    \n    // First verify we can write to Firestore\n    try {\n      const testRef = collection(db, 'referralCodes');\n      if (!testRef) {\n        throw new Error('Firestore not initialized');\n      }\n      \n      // Create the document data\n      const docData = {\n        code,\n        createdBy: userId,\n        createdAt: serverTimestamp(),\n        expiresAt: new Date(Date.now() + 48 * 60 * 60 * 1000),\n        used: false,\n        usedBy: null\n      };\n      \n      console.log('Attempting to save referral code:', docData);\n      \n      await addDoc(collection(db, 'referralCodes'), docData);\n      console.log('Successfully saved referral code to Firestore');\n    } catch (error) {\n      console.error('Firestore error:', error);\n      // Return the code even if save fails - we'll handle persistence later\n      console.log('Returning generated code despite Firestore error');\n      return code;\n    }\n    \n    return code;\n  } catch (error) {\n    console.error('Error generating referral code:', error);\n    // Return a temporary code if all else fails\n    const tempCode = generateUniqueCode();\n    console.log('Returning temporary code due to error:', tempCode);\n    return tempCode;\n  }\n};\n\nexport function generateUniqueCode() {\n  // Generate a code format: XXXX-XXXX-XXXX\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  const segments = 3;\n  const segmentLength = 4;\n  \n  let code = '';\n  for (let i = 0; i < segments; i++) {\n    for (let j = 0; j < segmentLength; j++) {\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    if (i < segments - 1) code += '-';\n  }\n  \n  return code;\n} "],"mappings":";AAAA,SAASA,YAAY,EAAEC,UAAU,EAAEC,MAAM,EAAEC,eAAe,QAAQ,oBAAoB;AACtF,SAASC,MAAM,QAAQ,cAAc;AAErC,OAAO,IAAMC,oBAAoB;EAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAG,WAAOC,MAAM,EAAK;IACpD,IAAI;MACFC,OAAO,CAACC,GAAG,CAAC,oCAAoC,EAAEF,MAAM,CAAC;MACzD,IAAMG,GAAG,GAAGP,MAAM,CAAC,CAAC;MACpB,IAAMQ,EAAE,GAAGZ,YAAY,CAACW,GAAG,CAAC;MAG5B,IAAME,IAAI,GAAGC,kBAAkB,CAAC,CAAC;MACjCL,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEG,IAAI,CAAC;MAG3C,IAAI;QACF,IAAME,OAAO,GAAGd,UAAU,CAACW,EAAE,EAAE,eAAe,CAAC;QAC/C,IAAI,CAACG,OAAO,EAAE;UACZ,MAAM,IAAIC,KAAK,CAAC,2BAA2B,CAAC;QAC9C;QAGA,IAAMC,OAAO,GAAG;UACdJ,IAAI,EAAJA,IAAI;UACJK,SAAS,EAAEV,MAAM;UACjBW,SAAS,EAAEhB,eAAe,CAAC,CAAC;UAC5BiB,SAAS,EAAE,IAAIC,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;UACrDC,IAAI,EAAE,KAAK;UACXC,MAAM,EAAE;QACV,CAAC;QAEDf,OAAO,CAACC,GAAG,CAAC,mCAAmC,EAAEO,OAAO,CAAC;QAEzD,MAAMf,MAAM,CAACD,UAAU,CAACW,EAAE,EAAE,eAAe,CAAC,EAAEK,OAAO,CAAC;QACtDR,OAAO,CAACC,GAAG,CAAC,+CAA+C,CAAC;MAC9D,CAAC,CAAC,OAAOe,KAAK,EAAE;QACdhB,OAAO,CAACgB,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAAC;QAExChB,OAAO,CAACC,GAAG,CAAC,kDAAkD,CAAC;QAC/D,OAAOG,IAAI;MACb;MAEA,OAAOA,IAAI;IACb,CAAC,CAAC,OAAOY,KAAK,EAAE;MACdhB,OAAO,CAACgB,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MAEvD,IAAMC,QAAQ,GAAGZ,kBAAkB,CAAC,CAAC;MACrCL,OAAO,CAACC,GAAG,CAAC,wCAAwC,EAAEgB,QAAQ,CAAC;MAC/D,OAAOA,QAAQ;IACjB;EACF,CAAC;EAAA,gBA9CYrB,oBAAoBA,CAAAsB,EAAA;IAAA,OAAArB,IAAA,CAAAsB,KAAA,OAAAC,SAAA;EAAA;AAAA,GA8ChC;AAED,OAAO,SAASf,kBAAkBA,CAAA,EAAG;EAEnC,IAAMgB,KAAK,GAAG,sCAAsC;EACpD,IAAMC,QAAQ,GAAG,CAAC;EAClB,IAAMC,aAAa,GAAG,CAAC;EAEvB,IAAInB,IAAI,GAAG,EAAE;EACb,KAAK,IAAIoB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,EAAEE,CAAC,EAAE,EAAE;IACjC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,aAAa,EAAEE,CAAC,EAAE,EAAE;MACtCrB,IAAI,IAAIiB,KAAK,CAACK,MAAM,CAACC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAGR,KAAK,CAACS,MAAM,CAAC,CAAC;IAChE;IACA,IAAIN,CAAC,GAAGF,QAAQ,GAAG,CAAC,EAAElB,IAAI,IAAI,GAAG;EACnC;EAEA,OAAOA,IAAI;AACb","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}